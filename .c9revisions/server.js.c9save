{"ts":1394653845983,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var express = require(\"express\"),\r\n    mongoose = require(\"mongoose\"),\r\n    passport = require(\"passport\"),\r\n    LocalStrategy = require(\"passport-local\").Strategy;\r\n\r\nvar env = process.env.NODE_ENV = process.env.NODE_ENV || 'development';\r\n\r\nvar app = express();\r\n\r\nvar config = require(\"./server/config/config\")[env];\r\n\r\nrequire(\"./server/config/express\")(app, config);\r\nrequire(\"./server/config/mongoose\")(config);\r\nrequire(\"./server/config/routes\")(app);\r\n\r\nvar User =  mongoose.model(\"User\");\r\npassport.use(new LocalStrategy(\r\n    function(username, password, done){\r\n        User.findOne({username: username}).exec(function(err, user){\r\n            if(user){\r\n                return done(null, user);\r\n            }\r\n            \r\n            return done(null, false);\r\n        })\r\n    }\r\n));\r\n\r\npassport.serializeUser(function(user, done){\r\n   if(user){\r\n       done(null, user.id);\r\n   } \r\n});\r\n\r\npassport.deserializeUser(function(id, done){\r\n    User.findOne({_id:id}).exec(function(err, user){\r\n        if(user){\r\n            return done(null, user);\r\n        }\r\n        \r\n        return done(null, false);\r\n    })\r\n});\r\n\r\napp.listen(config.port);\r\nconsole.log('Listening on port ' +config.port + '...');"]],"start1":0,"start2":0,"length1":0,"length2":1214}]],"length":1214}
